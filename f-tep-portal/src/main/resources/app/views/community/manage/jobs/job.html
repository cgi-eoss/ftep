<md-button class="close toolbar-button md-secondary"
           ng-click="jobParams.selectedJob = undefined"
           uib-tooltip="Close"
           tooltip-placement="top"
           tooltip-trigger="mouseenter"
           tooltip-append-to-body="true">
    <i class="material-icons">close</i>
</md-button>

<md-button id="update-job"
           class="save-button md-fab md-mini right"
           ng-click="refreshJob()"
           aria-label="Update Job"
           uib-tooltip="Update Job"
           tooltip-placement="top"
           tooltip-trigger="mouseenter"
           tooltip-append-to-body="true">
        <i class="material-icons">update</i>
</md-button>

<section id="job-title" class="row section-title">
    <div class="col-xs-10 title-text">
        <h2 ng-bind="'Job: ' + jobParams.selectedJob.id + ' - ' + jobParams.selectedJob.status" />
    </div>
</section>

<section id="job-overview" class="sub-title row">

    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'ID:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.extId" />
        </div>
    </div>

    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Owner:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.owner.name" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Stage:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.stage" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Status:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.status" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Start Time:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.details.startTime | formatDateTime" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'End Time:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.details.endTime | formatDateTime" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Name:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.config._embedded.service.name" />
        </div>
    </div>
    <div class="col-xs-12 col-md-6">
        <div class="col-xs-12 col-md-3 col-xl-2">
            <h5 ng-bind="'Description:'" />
        </div>
        <div class="col-xs-12 col-md-9 col-xl-10">
            <p ng-bind="jobParams.selectedJob.config._embedded.service.description" />
        </div>
    </div>
</section>

<section id="job-details" ng-cloak>
  <md-content>
    <md-tabs md-dynamic-height md-border-bottom>

      <md-tab label="Output">
        <md-content id="job-outputs" class="md-padding job-details-tab">
            <table ng-show="jobParams.selectedJob.downloadLinks">
                <tr ng-repeat="(key, file) in jobParams.selectedJob.downloadLinks">
                    <td>
                        <span ng-show="key === 0">Files</span>
                    </td>
                    <td ng-bind="key" />
                    <td class="download">
                        <a ng-href="{{file}}" target="_blank">
                            <i class="material-icons"
                               aria-label="Download"
                               uib-tooltip="Download"
                               tooltip-placement="top"
                               tooltip-trigger="mouseenter"
                               tooltip-append-to-body="true">
                                file_download
                            </i>
                        </a>
                    </td>
                </tr>
            </table>
            <div ng-show="!jobParams.selectedJob.outputs" class="note">
                No output files to display.
            </div>
        </md-content>
      </md-tab>

      <md-tab label="Input">
        <md-content id="job-inputs" class="md-padding job-details-tab">
            <table>
                <tr ng-repeat="(key, value) in jobParams.selectedJob.config.inputs">
                    <td ng-bind="key" />
                    <td>
                        <div ng-repeat="link in value">
                            <div ng-if="!link.includes('ftp')" class="col-sm-12" ng-bind="link" />
                            <div ng-if="link.includes('ftp')">
                                <div ng-repeat="file in splitInputFiles(link)">
                                    <a href="file" ng-bind="file" />
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </md-content>
      </md-tab>

      <md-tab label="Logs">
        <md-content id="job-log" class="md-padding job-details-tab ftep-log">
            <table>
                <tr>
                    <th>Timestamp</th>
                    <th>Message</th>
                </tr>
                <tr ng-repeat="message in jobParams.selectedJob.logs">
                    <td class="job-timestamp" ng-bind="message.timestamp" />
                    <td>
                        <pre class="job-message" ng-bind-html="message.message | nl2br" />
                    </td>
                </tr>
            </table>
        </md-content>
      </md-tab>
    </md-tabs>
  </md-content>
</section>
