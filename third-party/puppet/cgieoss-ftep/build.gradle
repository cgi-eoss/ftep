group 'com.cgi.eoss.f-tep'
version '0.1.0'


def srcs = fileTree('.') {
    include 'metadata.json'
    include 'LICENSE'
    include 'NOTICE'
    include 'README.md'
    include 'Gemfile'
    include 'Rakefile'
    include 'manifests/**/*'
    include 'spec/**/*'
    include 'templates/**/*'
}

task generateChecksums {
    def checksums = [:]
    srcs.visit { e ->
        if (!e.isDirectory) {
            def hash = java.security.MessageDigest.getInstance('MD5').with {
                e.file.eachByte(8192) { bfr, len ->
                    update bfr, 0, len
                }
                it.digest()
            }
            checksums.put(e.relativePath, new BigInteger(1, hash).toString(16).padLeft(32, '0'))
        }
    }

    def checksumsFile = new File('pkg/checksums.json')
    checksumsFile.write(groovy.json.JsonOutput.prettyPrint(groovy.json.JsonOutput.toJson(checksums)))
}

task build(type: Tar) {
    baseName = "cgieoss-ftep-${project.version}"
    extension = 'tar.gz'
    destinationDir = file('pkg')
    from srcs
    from 'pkg/checksums.json'
}
